# 实习9

## 一些问题

+ CI/CD流程
+ 运维维护机器
+ 测试是保证发布的系统的质量
+ 主要测试案例还是研发写
+ 系统的版本更替由研发者维护

## etcd软件需求

类似于zk，分布式场景下1.存储具体服务的元数据信息2.提供并发协调服务的存储系统，保证CAP定理中的CP属性。

### 1. 分布式存储

#### 1.1 数据模型需求

+ key value存储

#### 1.2 数据一致性需求

+ 任意时刻数据的强一致性：
  + 存储系统的所有节点有相同的读写顺序，且保证读操作读取结果是前一次写操作的结果

#### 1.3 容错需求

+ 假设有N个存储节点，最多能容忍(N-1)/2个节点故障。

### 2. 分布式协调

+ 类zk的watch接口，提供lease租约的支持。
+ 内置分布式协调原语

### 3. 其它

+ 集群用户验证

## etcd概要设计

### 1. 架构设计

#### 1.1 存储层

+ 底层使用boltdb(读多写少)
+ 内存b树保存db的索引，以key为键，索引为值

#### 1.2 分布式系统层

+ 使用raft算法通过备份状态机保证数据一致性
+ 读写请求均由leader节点处理

### 2. 接口设计

#### 2.1 存储访问接口

#### 2.2 分布式协调原语接口

+ 事务：2pc
+ 读写处理：读由follower处理
+ mvcc
