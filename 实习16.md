# 实习16

![linux性能分析](./figures/test-tool.png)

## 平均负载

+ 定义：系统处于可运行或不可中断状态的线程数。
    1. 可运行状态（Runnable）：正在使用或等待cpu的进程
    2. 不可中断状态；处于内核态关键流程中的进程，不可打断，如等待硬件设备的IO响应
+ uptime：查看平均负载
  + 配合watch命令使用
+ stress压测cpu、io等
+ pidstat：查看具体进程使用cpu情况
  + -u 5间隔5s后输出一组数据
+ mpstat：查看各cpu使用率情况
  + -P ALL查看所有cpu
  + 加数字每间隔几秒输出
+ 宏观判断系统负载情况，负载高可能由io密集（进程等待）或cpu密集（进程一直运行）导致。

## 上下文切换

+ 系统调用：用户态、内核态切换 => 两次cpu上下文切换
+ 进程上下文切换：cpu上下文切换 + 当前进程上下文保存 + 新进程上下文加载
+ 线程上下文切换：轻量级
+ 中断上下文切换：
